---
title: "Seattle College Enrollments"
author: "Brian Holt"
date: "1/26/2020"
output:
  html_document:
    df_print: paged
  pdf_document: default
  rmdformats::html_clean:
    TOC: yes
    highlight: kate
---
##A small project tracking enrollments

```{r setup, echo=FALSE, cache=FALSE}
library(knitr)
library(rmdformats)

## Global options
options(max.print="75")
opts_chunk$set(echo=FALSE,
	             cache=TRUE,
               prompt=FALSE,
               tidy=TRUE,
               comment=NA,
               message=FALSE,
               warning=FALSE)
opts_knit$set(width=75)
```

```{r, packages and data,echo=F}
load('main.df.Rdata')
library(tidyverse)
library(lubridate)
library(purrr)
```

##Some Data since 1985

```{r quick processing and graphing of enrollments,include =F}
main.df %>% select(college,code, Season,yr,scrap_enrol,site_clus_enrol) %>% 
  mutate(Date=
           ifelse(grepl("A|B|9903|9904",code),
                  paste0('20',yr),
                  paste0('19',yr))) %>% 
  mutate(Date=case_when(
    Season=='Summer'~paste0(Date,'-','07','-','20'),
    Season=='Fall'~paste0(Date,'-','10','-','20'),
    Season=='Winter'~paste0(Date,'-','01','-','20'),
    Season=='Spring'~paste0(Date,'-','04','-','20')
  )) %>% 
  mutate(Date = ymd(Date)) %>% #filter(Season!="Summer") %>% 
  
  ggplot(aes(x=Date,y=scrap_enrol,color=Season))+geom_line()+#geom_smooth(method="loess")+
  #geom_vline(xintercept = as.numeric(ymd('2009-10-20')))+
  facet_wrap(~college)
  #geom_hline(yintercept = 10568)
```

This table looks at the highest enrollment (around 2009) and compares the percentage drop among the colleges.

062 = Central;

063 = North;

064 = South

```{r, drop from high, echo=F }
main.df %>% select(college,code, Season,yr,scrap_enrol,site_clus_enrol) %>% 
  mutate(Date=
           ifelse(grepl("A|B|9903|9904",code),
                  paste0('20',yr),
                  paste0('19',yr))) %>% 
  mutate(Date=case_when(
    Season=='Summer'~paste0(Date,'-','07','-','20'),
    Season=='Fall'~paste0(Date,'-','10','-','20'),
    Season=='Winter'~paste0(Date,'-','01','-','20'),
    Season=='Spring'~paste0(Date,'-','04','-','20')
    )) %>% 
  mutate(Date = ymd(Date)) %>% filter(Season!="Summer") %>% group_by(college) %>% 
  summarise(max=max(scrap_enrol+site_clus_enrol),
            recent_qrt= sum(scrap_enrol[code=='B902']+
                              site_clus_enrol[code=='B902']),
            Percent_drop=( round((max-recent_qrt)/max*100,1)))
```




##identify cancelled

```{r}

df %>% 
  group_by(cancel,college,Season) %>% 
  summarize(sumEnrol=sum(Enrolled),
                        meanEnr=sumEnrol/n())
```



```{r change from factor to character to change back, include =T}

df<- df %>% mutate(college=as.character(college)) %>% 
  mutate(college = as.factor(ifelse(college=='062',"Central",ifelse(college=='063',"North","South"))))

```

```{r calc enrolled by college over time, include=T,fig.dim=c(6,4)}
df %>% select(college,code,Season,yr,Enrolled,cancel) %>% 
  mutate(Date=
           ifelse(grepl("A|B|9903|9904",code),
                  paste0('20',yr),
                  paste0('19',yr))) %>% 
  mutate(Date=case_when(
    Season=='Summer'~paste0(Date,'-','07','-','20'),
    Season=='Fall'~paste0(Date,'-','10','-','20'),
    Season=='Winter'~paste0(Date,'-','01','-','20'),
    Season=='Spring'~paste0(Date,'-','04','-','20')
    )) %>% 
  mutate(Date = ymd(Date)) %>% filter(Season!="Summer" ) %>% 
  group_by(college,Date,Season,cancel) %>% summarise(Total_cancel=sum(cancel)) %>% 
  ggplot(aes(x=Date,y=Total_cancel,color=Season))+geom_line()+facet_wrap(~college)+ggtitle("Total Enrollment over time")

```
  
```{r, prove that differences bw enrollof scrap vs site, comments=T}
  
##at some point would be worth confirming that the scrapped data looks like the calc'd data 

#summer 04 the 'new' AU codes went into effect

```  
  
```{r calc enrolled vs State FTE by Season codes over time, include=T,fig.dim=c(6,4)}
df %>% select(college,code,Season,yr,Enrolled,State.FTES) %>% 
  mutate(Date=
           ifelse(grepl("A|B|9903|9904",code),
                  paste0('20',yr),
                  paste0('19',yr))) %>% 
  mutate(Date=case_when(
    Season=='Summer'~paste0(Date,'-','07','-','20'),
    Season=='Fall'~paste0(Date,'-','10','-','20'),
    Season=='Winter'~paste0(Date,'-','01','-','20'),
    Season=='Spring'~paste0(Date,'-','04','-','20')
    )) %>% 
  mutate(Date = ymd(Date)) %>% filter(Season!="Summer") %>% 
  group_by(college,Date,Season) %>% summarise(Enrollment_Total=sum(Enrolled),State_FTE_tot=sum(State.FTES)) %>% 
  ggplot(aes(x=Date,y=State_FTE_tot,color=Season))+geom_line()+facet_wrap(~college)+ggtitle("Total State FTE's")
#+theme(legend.position = "none")

```

##Questions?

Here is the data I have since 1985, what questions might you want answers to?

`r colnames(df)[-22]`


###Caveats:

**In 2004, the AU (administrative unit) codes changed, but this is how we'd track Division and program data.  I need to rig up some SQL to join this data to some titles from an excel table;

**The convention for tracking instructor names changes overtime making it hard to just pull out one person.  Ideally there would be a primary key for instructor, but that isn't trivial to create and using Employment ID is risky.

** I need to learn what the Pro and Org budgets mean. 

##What questions might you like?

How has nursing impacted FTE's since they moved to District? 

---
title: "Seattle College Enrollments"
author: "Brian Holt"
date: "1/26/2020"
output:
  html_document:
    df_print: paged
  rmdformats::html_clean:
    TOC: yes
    highlight: kate
---

```{r setup, echo=FALSE, cache=FALSE}
library(knitr)
library(rmdformats)

## Global options
options(max.print="75")
opts_chunk$set(echo=FALSE,
	             cache=TRUE,
               prompt=FALSE,
               tidy=TRUE,
               comment=NA,
               message=FALSE,
               warning=FALSE)
opts_knit$set(width=75)
```

## Packages

```{r, packages and data,echo=T}
load('main.df')
library(tidyverse)
library(lubridate)
library(purrr)
```

The following drops Summers

```{r quick processing and graphing of enrollments,include =T}
main.df %>% select(college,code, Season,yr,scrap_enrol,site_clus_enrol) %>% 
  mutate(Date=
           ifelse(grepl("A|B|9903|9904",code),
                  paste0('20',yr),
                  paste0('19',yr))) %>% 
  mutate(Date=case_when(
    Season=='Summer'~paste0(Date,'-','07','-','20'),
    Season=='Fall'~paste0(Date,'-','10','-','20'),
    Season=='Winter'~paste0(Date,'-','01','-','20'),
    Season=='Spring'~paste0(Date,'-','04','-','20')
  )) %>% 
  mutate(Date = ymd(Date)) %>% filter(Season!="Summer") %>% 
  
  ggplot(aes(x=Date,y=scrap_enrol,color=Season))+geom_line()+#geom_smooth(method="loess")+
  #geom_vline(xintercept = as.numeric(ymd('2009-10-20')))+
  facet_wrap(~college)
  #geom_hline(yintercept = 10568)
```

This table looks at the highest enrollment (around 2009) and compares the relative drop amoung the colleges.
```{r, drop from high, echo=F }
main.df %>% select(college,code, Season,yr,scrap_enrol,site_clus_enrol) %>% 
  mutate(Date=
           ifelse(grepl("A|B|9903|9904",code),
                  paste0('20',yr),
                  paste0('19',yr))) %>% 
  mutate(Date=case_when(
    Season=='Summer'~paste0(Date,'-','07','-','20'),
    Season=='Fall'~paste0(Date,'-','10','-','20'),
    Season=='Winter'~paste0(Date,'-','01','-','20'),
    Season=='Spring'~paste0(Date,'-','04','-','20')
    )) %>% 
  mutate(Date = ymd(Date)) %>% filter(Season!="Summer") %>% group_by(college) %>% 
  summarise(max=max(scrap_enrol+site_clus_enrol),
            recent_qrt= sum(scrap_enrol[code=='B902']+
                              site_clus_enrol[code=='B902']),
            Percent_drop=( round((max-recent_qrt)/max*100,1)))
  
  
```



library(dplyr)
library(purrr)
library(repurrrsive)

(nms <- map_chr(got_chars, "name"))
map_dfr(got_chars, `[`, c("name", "gender", "culture", "born"))
map(main.df$scrap_tbl, `[`,c("Enrolled","Class.Size"))


extract_data<- function(x,y) {
cbind(main.df$college[1],main.df$scrap_tbl[[1]]["Waitlist"])
}
df<- apply(main.df,1,extract_data)
tail(df)


df<- cbind(main.df$college,lapply(main.df$scrap_tbl, `[`, c('Enrolled', 'Waitlist')))

do.call


Combining a list of data frames into a single data frame

A common task is combining a list of data frames into one big data frame. If you want to stack them on top of each other, you would use rbind for a pair of them, but for a list of data frames here are three good choices:

# base option - slower but not extra dependencies
big_data = do.call(what = rbind, args = df_list)

# data table and dplyr have nice functions for this that
#  - are much faster
#  - add id columns to identify the source
#  - fill in missing values if some data frames have more columns than others
# see their help pages for details
big_data = data.table::rbindlist(df_list)
big_data = dplyr::bind_rows(df_list)

(Similarly using cbind or dplyr::bind_cols for columns.)

To merge (join) a list of data frames, you can see these answers. Often, the idea is to use Reduce with merge (or some other joining function) to get them together.

https://stackoverflow.com/questions/17499013/how-do-i-make-a-list-of-data-frames

https://www.google.com/search?client=firefox-b-1-d&q=adding+data.frames+to+list+rstats